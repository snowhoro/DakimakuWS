var FlowChart=function(t){var e=this;e.jQueryLibraryObj=t,e.jQueryLibraryObj("body").append(e.connectionsLayerTemplate),e.jQueryLibraryObj("body").append(e.nodesLayerTemplate)};FlowChart.prototype.jQueryLibraryObj={},FlowChart.prototype.connectionsLayerTemplate="<svg id='connections-layer' class='layer'><svg>",FlowChart.prototype.nodesLayerTemplate="<div id='nodes-layer' class='layer'></div>",FlowChart.prototype.nodeTemplates={"simple-node":"simple node"},FlowChart.prototype.rootElementPosition={left:10,top:10},FlowChart.prototype.offsetForNextElement=200,FlowChart.prototype.nodeActionEndEffect="bounce",FlowChart.prototype.addNodeActions=function(t,e){t.click(function(){e.addNode("simple-node",t)})},FlowChart.prototype.elementIndex=0,FlowChart.prototype.nextElementIndex=function(){return this.elementIndex=this.elementIndex+1,this.elementIndex},FlowChart.prototype.connections={},FlowChart.prototype.addOrUpdateConnectionInConnectionsObject=function(t,e,o,n){this.connections[t]={start:e,end:o,d:n}},FlowChart.prototype.deleteConnectionFromConnectionsObject=function(t){delete this.connections[t]},FlowChart.prototype.getConnectionFromConnectionsObject=function(t){return this.connections[t]},FlowChart.prototype.nodes={},FlowChart.prototype.addOrUpdateNodeInNodesObject=function(t,e,o,n,r,i,d){this.nodes[t]={type:e,content:o,left:n,top:r,startFor:i,endFor:d}},FlowChart.prototype.deleteNodeFromNodesObject=function(t){delete this.nodes[t]},FlowChart.prototype.getNodeFromNodesObject=function(t){return this.nodes[t]},FlowChart.prototype.positionConnectionPoint=function(t,e,o,n,r){var i=this.getConnectionFromConnectionsObject(n.attr("id")).d.split(" ");"endpoint"===o&&(i[3]=t+","+e,r&&(i[2]=t+","+e)),"startpoint"===o&&(i[0]="M"+t+","+e,r&&(i[1]="C"+t+","+e)),i=i.join(" "),n.attr("d",i),this.connections[n.attr("id")].d=i},FlowChart.prototype.positionConnectionLines=function(t,e){for(var o=this,n=t,r=n.offset().left+n.outerWidth()/2,i=n.offset().top+n.outerHeight()/2,d=o.nodes[n.attr("id")].startFor,s=o.nodes[n.attr("id")].endFor,a=0;a<d.length;a++)this.positionConnectionPoint(r,i,"startpoint",o.jQueryLibraryObj("#"+d[a]),e);for(var a=0;a<s.length;a++)this.positionConnectionPoint(r,i,"endpoint",o.jQueryLibraryObj("#"+s[a]),e)},FlowChart.prototype.addNodeWithIdContentAndPosition=function(t,e,o,n,r){var i=this;o&&""!==o||(o=i.nodeTemplates[e]);var d=this.jQueryLibraryObj("#nodes-layer"),s="node "+e,a="<div id='"+t+"' class='"+s+"'>"+o+"</div>";return d.append(a),a=this.jQueryLibraryObj("#"+t),i.addOrUpdateNodeInNodesObject(t,e,i.nodeTemplates[e],0,0,[],[]),a.offset({left:n,top:r}),i.nodes[t].left=n,i.nodes[t].top=r,a.draggable({drag:function(){i.positionConnectionLines(i.jQueryLibraryObj(this),!1)},stop:function(){var t=i.jQueryLibraryObj(this);i.nodes[t.attr("id")].left=t.offset().left,i.nodes[t.attr("id")].top=t.offset().top,i.positionConnectionLines(t,!0),i.adjustLayersSize(),i.nodeActionEndEffect&&t.effect(i.nodeActionEndEffect,{},500,function(){})}}),a.droppable({drop:function(t,e){var o=i.jQueryLibraryObj(this),n=e.draggable;i.addConnectionBetween(n,o)}}),i.addNodeActions(a,i),i.adjustLayersSize(),i.nodeActionEndEffect&&a.effect(i.nodeActionEndEffect,{},500,function(){}),a},FlowChart.prototype.addNodeWithPosition=function(t,e,o){var n=this;return n.addNodeWithIdContentAndPosition("node-"+n.nextElementIndex(),t,n.nodeTemplates[t],e,o)},FlowChart.prototype.addNode=function(t,e){var o=this,n=0,r=0,i=null;return e?(n=e.offset().left+o.offsetForNextElement,r=e.offset().top,i=o.addNodeWithPosition(t,n,r),o.addConnectionBetween(e,i)):(n=o.rootElementPosition.left,r=o.rootElementPosition.top,i=o.addNodeWithPosition(t,n,r)),i},FlowChart.prototype.deleteNode=function(t){var e=this,o=e.jQueryLibraryObj("#"+t),n=e.getNodeFromNodesObject(t),r=n.startFor,i=n.endFor;o.remove(),e.deleteNodeFromNodesObject(t);for(var d=0;d<r.length;d++)e.deleteConnection(r[d]);for(var d=0;d<i.length;d++)e.deleteConnection(i[d])},FlowChart.prototype.deleteConnection=function(t){var e=this.jQueryLibraryObj("#"+t),o=this.getConnectionFromConnectionsObject(t),n=this.nodes[o.start],r=this.nodes[o.end];if(n){var i=n.startFor,d=i.indexOf(t);i.splice(d,1),this.nodes[o.start].startFor=i}if(r){var s=r.endFor,d=s.indexOf(t);s.splice(d,1),this.nodes[o.end].endFor=s}this.deleteConnectionFromConnectionsObject(t),e.remove()},FlowChart.prototype.addConnectionBetween=function(t,e){var o=this,n=this.addConnection(t,e),r=this.nodes[t.attr("id")].startFor;r.push(n),this.nodes[t.attr("id")].startFor=r;var i=this.nodes[e.attr("id")].endFor;i.push(n),this.nodes[e.attr("id")].endFor=i,o.positionConnectionLines(t,!0),o.positionConnectionLines(e,!0)},FlowChart.prototype.addConnection=function(t,e){var o=this.jQueryLibraryObj("#connections-layer"),n=(new Date,t.offset()),r=e.offset(),i="M"+n.left+","+n.top+" C"+n.left+","+n.top+" "+r.left+","+r.top+" "+r.left+","+r.top,d=document.createElementNS("http://www.w3.org/2000/svg","path");return d.setAttributeNS(null,"id","line-"+this.nextElementIndex()),d.setAttributeNS(null,"d",i),o[0].appendChild(d),this.addOrUpdateConnectionInConnectionsObject("line-"+this.elementIndex,t.attr("id"),e.attr("id"),i),"line-"+this.elementIndex},FlowChart.prototype.adjustLayersSize=function(){this.jQueryLibraryObj(".layer").width(this.jQueryLibraryObj(document).width()).height(this.jQueryLibraryObj(document).height())},FlowChart.prototype.exportChart=function(){var t=this.nodes,e=this.connections,o={nodes:[],connections:[]};for(var n in t)if(t.hasOwnProperty(n)){var r={id:n,type:t[n].type,content:t[n].content,left:t[n].left,top:t[n].top};o.nodes.push(r)}for(var i in e)if(e.hasOwnProperty(i)){var d={start:e[i].start,end:e[i].end};o.connections.push(d)}return o},FlowChart.prototype.importChart=function(t){for(var e=this,o=t.nodes,n=t.connections,r=0;r<o.length;r++)e.addNodeWithIdContentAndPosition(o[r].id,o[r].type,o[r].content,o[r].left,o[r].top);for(var r=0;r<n.length;r++){var i=e.jQueryLibraryObj("#"+n[r].start),d=e.jQueryLibraryObj("#"+n[r].end);e.addConnectionBetween(i,d)}};
